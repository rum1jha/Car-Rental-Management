--------------------------------------------------------
--  File created - Saturday-December-04-2021   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Procedure PROC_INSERT_VIOLATIONS_RECORD
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ADMIN"."PROC_INSERT_VIOLATIONS_RECORD" 
(
  vRECORD_ID IN VIOLATIONS_RECORDS.RECORD_ID%type 
, vRECORD_DATE IN VIOLATIONS_RECORDS.RECORD_DATE%type 
, vCUSTOMER_ID IN CUSTOMERS.CUSTOMER_ID%type 
, vVIOLATION_ID IN VIOLATIONS.VIOLATION_ID%type
) AS

    ex_INVALID_RECORD_DATE EXCEPTION;
    ex_NO_CUSTOMER_FOUND EXCEPTION;
    ex_NO_VIOLATION_FOUND EXCEPTION;
    ex_FAILURE EXCEPTION;
    db_CUSTOMER_ID CUSTOMERS.CUSTOMER_ID%type;
    db_VIOLATION_ID VIOLATIONS.VIOLATION_ID%type;
BEGIN

    if vRECORD_DATE > sysdate then
        raise ex_INVALID_RECORD_DATE;
    end if;
    
    begin
        select CUSTOMER_ID into db_CUSTOMER_ID from CUSTOMERS where CUSTOMER_ID = vCUSTOMER_ID;
        if db_CUSTOMER_ID is NULL then
             raise NO_DATA_FOUND;
        end if;
    exception
        when NO_DATA_FOUND then
            raise ex_NO_CUSTOMER_FOUND;
    end;
    
    begin
        select VIOLATION_ID into db_VIOLATION_ID from VIOLATIONS where VIOLATION_ID = vVIOLATION_ID;
        if db_VIOLATION_ID is NULL then
             raise NO_DATA_FOUND;
        end if;
    exception
        when NO_DATA_FOUND then
            raise ex_NO_VIOLATION_FOUND;
    end;
    
    insert into VIOLATIONS_RECORDS values(
        vRECORD_ID,
        vRECORD_DATE,
        vCUSTOMER_ID,
        vVIOLATION_ID
    );
    
    if SQL%ROWCOUNT != 1 then
        rollback;
        raise ex_FAILURE;
    else 
        dbms_output.put_line('Violations Data Inserted Successfully !!!');
    end if;
    
EXCEPTION
    when ex_INVALID_RECORD_DATE then
        dbms_output.put_line('Violations Data Could Not Be Inserted !!!');
    when ex_NO_CUSTOMER_FOUND then
        dbms_output.put_line('No Customer Id Found To Insert Violation Record!!!');
    when ex_NO_VIOLATION_FOUND then
        dbms_output.put_line('No Violation Id Found To Insert Violation Record!!!');
    when ex_FAILURE then
        dbms_output.put_line('Violations Data Inserted Successfully !!!');


END PROC_INSERT_VIOLATIONS_RECORD;

/
